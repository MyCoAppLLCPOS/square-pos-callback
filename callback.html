<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Result</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f3f4f6; text-align: center; }
        .container { background-color: #ffffff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); max-width: 400px; width: 100%; }
        #status-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        #status-message { color: #4b5563; }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="status-title">Processing...</h1>
        <p id="status-message">Please wait while we update the record in AppSheet.</p>
    </div>

    <form id="apps-script-form" method="POST" style="display: none;">
        <input type="hidden" name="transactionId" id="transactionId">
        <input type="hidden" name="status" id="status">
        <input type="hidden" name="paymentId" id="paymentId">
        <input type="hidden" name="error" id="error">
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const transactionId = urlParams.get('transaction_id');
            const status = urlParams.get('status');
            const paymentId = urlParams.get('payment_id');
            const error = urlParams.get('error_code') || urlParams.get('error_message');

            const statusTitle = document.getElementById('status-title');
            const statusMessage = document.getElementById('status-message');

            if (status === 'success') {
                statusTitle.innerText = "Payment Successful!";
                statusTitle.style.color = '#10b981';
                statusMessage.innerText = "The transaction has been completed. You can now close this page.";
            } else if (status === 'error') {
                statusTitle.innerText = "Payment Failed!";
                statusTitle.style.color = '#ef4444';
                statusMessage.innerText = "An error occurred: " + (error || "Unknown Error") + ". You can close this page.";
            } else {
                statusTitle.innerText = "Payment Canceled";
                statusTitle.style.color = '#f59e0b';
                statusMessage.innerText = "The transaction was canceled. You can now close this page.";
            }

            // Fill the hidden form fields with the payment data
            document.getElementById('transactionId').value = transactionId;
            document.getElementById('status').value = status;
            document.getElementById('paymentId').value = paymentId;
            document.getElementById('error').value = error;
            
            // Set the form action URL
            // *** IMPORTANT: UPDATE THIS URL WITH YOUR CURRENT APPS SCRIPT DEPLOYMENT URL ***
            const appsScriptUrl = "https://script.google.com/macros/s/AKfycbzlCa3FhtyJdxlz1lpG0isVqPzcp-MCTz9tldfcy66kJ4KhCHoGePdHWOdutPNSerdUrw/exec";
            document.getElementById('apps-script-form').action = appsScriptUrl;

            // Submit the form automatically after a short delay
            setTimeout(function() {
                document.getElementById('apps-script-form').submit();
            }, 1000); // 1-second delay
        });
    </script>
</body>
</html>



