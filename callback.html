<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Result</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f3f4f6; text-align: center; }
        .container { background-color: #ffffff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); max-width: 400px; width: 100%; }
        #status-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        #status-message { color: #4b5563; }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="status-title">Processing...</h1>
        <p id="status-message">Please wait while we update the record in AppSheet.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = {
                transactionId: urlParams.get('transaction_id'),
                status: urlParams.get('status'),
                paymentId: urlParams.get('payment_id'),
                error: urlParams.get('error_code') || urlParams.get('error_message')
            };

            const statusTitle = document.getElementById('status-title');
            const statusMessage = document.getElementById('status-message');

            if (data.status === 'success') {
                statusTitle.innerText = "Payment Successful!";
                statusTitle.style.color = '#10b981';
                statusMessage.innerText = "The transaction has been completed. You can now close this page.";
            } else if (data.status === 'error') {
                statusTitle.innerText = "Payment Failed!";
                statusTitle.style.color = '#ef4444';
                statusMessage.innerText = "An error occurred: " + (data.error || "Unknown Error") + ". You can close this page.";
            } else {
                statusTitle.innerText = "Payment Canceled";
                statusTitle.style.color = '#f59e0b';
                statusMessage.innerText = "The transaction was canceled. You can close this page.";
            }

            const appsScriptUrl = "https://script.google.com/macros/s/AKfycbxsNnXh455Hl2SoI7A9eDmu8LrRVqFkSsuqhG9elQkSYSjFC_CtxHSyqoO1Jw8ozmtrtg/exec";

            fetch(appsScriptUrl, {
                method: "POST",
                body: JSON.stringify(data),
                headers: {
                    "Content-Type": "text/plain"
                }
            })
            .then(response => response.json())
            .then(result => {
                console.log('Apps Script response:', result);
            })
            .catch(error => {
                console.error('Error sending data to Apps Script:', error);
            });
        });
    </script>
</body>
</html>
